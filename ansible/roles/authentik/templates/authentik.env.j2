# Authentik Configuration
# Managed by Ansible - do not edit manually

# PostgreSQL
AUTHENTIK_POSTGRESQL__HOST={{ authentik_postgres_host }}
AUTHENTIK_POSTGRESQL__PORT={{ authentik_postgres_port }}
AUTHENTIK_POSTGRESQL__NAME={{ authentik_postgres_db }}
AUTHENTIK_POSTGRESQL__USER={{ authentik_postgres_user }}
AUTHENTIK_POSTGRESQL__PASSWORD={{ authentik_postgres_password }}

# Redis
AUTHENTIK_REDIS__HOST={{ authentik_redis_host }}
AUTHENTIK_REDIS__PORT={{ authentik_redis_port }}

# Secret key (generate with: openssl rand -hex 32)
AUTHENTIK_SECRET_KEY={{ authentik_secret_key }}

# Error reporting
AUTHENTIK_ERROR_REPORTING__ENABLED={{ authentik_error_reporting_enabled | lower }}

# Email configuration
{% if authentik_email_host %}
AUTHENTIK_EMAIL__HOST={{ authentik_email_host }}
AUTHENTIK_EMAIL__PORT={{ authentik_email_port }}
AUTHENTIK_EMAIL__USERNAME={{ authentik_email_username }}
AUTHENTIK_EMAIL__PASSWORD={{ authentik_email_password }}
AUTHENTIK_EMAIL__USE_TLS={{ authentik_email_use_tls | lower }}
AUTHENTIK_EMAIL__USE_SSL={{ authentik_email_use_ssl | lower }}
AUTHENTIK_EMAIL__FROM={{ authentik_email_from }}
{% endif %}

# Log level
AUTHENTIK_LOG_LEVEL={{ authentik_log_level }}

# Unique host identification
AUTHENTIK_HOST={{ ansible_hostname }}
AUTHENTIK_HOST_BROWSER=http://{{ ansible_default_ipv4.address }}:{{ authentik_http_port }}

# External URL - CRITICAL for OAuth2/SAML
AUTHENTIK_EXTERNAL_URL={{ authentik_external_url }}

# Disable startup analytics
AUTHENTIK_DISABLE_STARTUP_ANALYTICS=true
AUTHENTIK_DISABLE_UPDATE_CHECK=false

# Avatar settings
AUTHENTIK_AVATARS=initials

# Footer links
AUTHENTIK_FOOTER_LINKS=[]

# GeoIP
AUTHENTIK_GEOIP=/geoip/GeoLite2-City.mmdb

# Blueprints
AUTHENTIK_BLUEPRINTS_ENABLED={{ authentik_enable_blueprints | lower }}

# Default user settings
AUTHENTIK_DEFAULT_USER_CHANGE_NAME=true
AUTHENTIK_DEFAULT_USER_CHANGE_EMAIL=true
AUTHENTIK_DEFAULT_USER_CHANGE_USERNAME=false

# Session settings
AUTHENTIK_SESSION_COOKIE_SAMESITE=lax

# CSRF settings
AUTHENTIK_CSRF_COOKIE_SAMESITE=lax

# Metrics
AUTHENTIK_METRICS_ENABLED={{ authentik_enable_metrics | lower }}
AUTHENTIK_METRICS_PORT={{ authentik_metrics_port }}